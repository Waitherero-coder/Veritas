import React from 'react';import {importKey,decryptFile} from '../utils/crypto';import {supabase} from '../supabaseClient';type Props={filePath:string};const FileDownload:React.FC<Props>=({filePath})=>{const handleFileDownload=async(keyFile:File)=>{const keyBytes=new Uint8Array(await keyFile.arrayBuffer());const key=await importKey(keyBytes);const {data,error}=await supabase.storage.from('evidence-files').download(filePath);if(error)return alert(error.message);const decryptedBlob=await decryptFile(data!,key);const url=URL.createObjectURL(decryptedBlob);const a=document.createElement('a');a.href=url;a.download=filePath.split('/').pop()!;a.click();};return <input type="file" accept=".key" onChange={(e)=>e.target.files&&handleFileDownload(e.target.files[0])}/>};export default FileDownload;
