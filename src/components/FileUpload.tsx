import React from 'react';import {generateKey,encryptFile,exportKey} from '../utils/crypto';import {supabase} from '../supabaseClient';type Props={caseId:string};const FileUpload:React.FC<Props>=({caseId})=>{const handleFileUpload=async(e:React.ChangeEvent<HTMLInputElement>)=>{if(!e.target.files)return;const file=e.target.files[0];const key=await generateKey();const encryptedFile=await encryptFile(file,key);const {data,error}=await supabase.storage.from('evidence-files').upload(`case-${caseId}/${file.name}`,encryptedFile);if(error)return alert(error.message);const keyBytes=await exportKey(key);const keyBlob=new Blob([keyBytes],{type:'application/octet-stream'});const keyUrl=URL.createObjectURL(keyBlob);const a=document.createElement('a');a.href=keyUrl;a.download=`${file.name}.key`;a.click();alert('File uploaded and key file downloaded!');};return <input type="file" onChange={handleFileUpload}/>};export default FileUpload;
